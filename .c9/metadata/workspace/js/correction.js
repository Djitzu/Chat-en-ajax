{"filter":false,"title":"correction.js","tooltip":"/js/correction.js","undoManager":{"mark":5,"position":5,"stack":[[{"start":{"row":0,"column":0},"end":{"row":26,"column":1},"action":"insert","lines":["function getMessages(){","  // 1. Elle doit créer une requête AJAX pour se connecter au serveur, et notamment au fichier handler.php","  const requeteAjax = new XMLHttpRequest();","  requeteAjax.open(\"GET\", \"handler.php\");","","  // 2. Quand elle reçoit les données, il faut qu'elle les traite (en exploitant le JSON) et il faut qu'elle affiche ces données au format HTML","  requeteAjax.onload = function(){","    const resultat = JSON.parse(requeteAjax.responseText);","    const html = resultat.reverse().map(function(message){","      return `","        <div class=\"message\">","          <span class=\"date\">${message.created_at.substring(11, 16)}</span>","          <span class=\"author\">${message.author}</span> : ","          <span class=\"content\">${message.content}</span>","        </div>","      `","    }).join('');","","    const messages = document.querySelector('.messages');","","    messages.innerHTML = html;","    messages.scrollTop = messages.scrollHeight;","  }","","  // 3. On envoie la requête","  requeteAjax.send();","}"],"id":1}],[{"start":{"row":0,"column":0},"end":{"row":26,"column":1},"action":"remove","lines":["function getMessages(){","  // 1. Elle doit créer une requête AJAX pour se connecter au serveur, et notamment au fichier handler.php","  const requeteAjax = new XMLHttpRequest();","  requeteAjax.open(\"GET\", \"handler.php\");","","  // 2. Quand elle reçoit les données, il faut qu'elle les traite (en exploitant le JSON) et il faut qu'elle affiche ces données au format HTML","  requeteAjax.onload = function(){","    const resultat = JSON.parse(requeteAjax.responseText);","    const html = resultat.reverse().map(function(message){","      return `","        <div class=\"message\">","          <span class=\"date\">${message.created_at.substring(11, 16)}</span>","          <span class=\"author\">${message.author}</span> : ","          <span class=\"content\">${message.content}</span>","        </div>","      `","    }).join('');","","    const messages = document.querySelector('.messages');","","    messages.innerHTML = html;","    messages.scrollTop = messages.scrollHeight;","  }","","  // 3. On envoie la requête","  requeteAjax.send();","}"],"id":3},{"start":{"row":0,"column":0},"end":{"row":60,"column":14},"action":"insert","lines":["function getMessages(){","  // 1. Elle doit créer une requête AJAX pour se connecter au serveur, et notamment au fichier handler.php","  const requeteAjax = new XMLHttpRequest();","  requeteAjax.open(\"GET\", \"handler.php\");","","  // 2. Quand elle reçoit les données, il faut qu'elle les traite (en exploitant le JSON) et il faut qu'elle affiche ces données au format HTML","  requeteAjax.onload = function(){","    const resultat = JSON.parse(requeteAjax.responseText);","    const html = resultat.reverse().map(function(message){","      return `","        <div class=\"message\">","          <span class=\"date\">${message.created_at.substring(11, 16)}</span>","          <span class=\"author\">${message.author}</span> : ","          <span class=\"content\">${message.content}</span>","        </div>","      `","    }).join('');","","    const messages = document.querySelector('.messages');","","    messages.innerHTML = html;","    messages.scrollTop = messages.scrollHeight;","  }","","  // 3. On envoie la requête","  requeteAjax.send();"," ","}","","function postMessage(event){","    //stopper le formulaire","    event.preventDefault();","    ","    //Récupérer les données du formulaire","    const author = document.querySelector('#author');","    const content = document.querySelector('#content');","    ","    //Conditionner les données","    const data = new FormData();","    data.append('author', author.value);","    data.append('content', content.value);","    ","    //configurer une requete ajax en post","    const requeteAjax = new XMLHttpRequest();","    requeteAjax.open('POST', 'handler.php?task=write');","    ","    requeteAjax.onload = function()","    {","        content.value = '';","        content.focus;","        getMessages();","    }","    ","    requeteAjax.send(data);","}","","document.querySelector('form').addEventListener('submit', postMessage);","","window.setInterval(getMessages, 3000);","","getMessages();"]}],[{"start":{"row":7,"column":58},"end":{"row":8,"column":0},"action":"insert","lines":["",""],"id":4},{"start":{"row":8,"column":0},"end":{"row":8,"column":4},"action":"insert","lines":["    "]}],[{"start":{"row":8,"column":4},"end":{"row":8,"column":26},"action":"insert","lines":["console.log(resultat);"],"id":5}],[{"start":{"row":8,"column":4},"end":{"row":8,"column":5},"action":"insert","lines":["/"],"id":6}],[{"start":{"row":8,"column":5},"end":{"row":8,"column":6},"action":"insert","lines":["/"],"id":7}],[{"start":{"row":10,"column":3},"end":{"row":11,"column":0},"action":"remove","lines":["",""],"id":14}],[{"start":{"row":11,"column":0},"end":{"row":12,"column":0},"action":"remove","lines":["",""],"id":13}],[{"start":{"row":12,"column":0},"end":{"row":13,"column":21},"action":"remove","lines":["  // 3. On envoie la requête","  requeteAjax.send();"],"id":12}],[{"start":{"row":9,"column":4},"end":{"row":22,"column":47},"action":"remove","lines":["const html = resultat.reverse().map(function(message){","      return `","        <div class=\"message\">","          <span class=\"date\">${message.created_at.substring(11, 16)}</span>","          <span class=\"author\">${message.author}</span> : ","          <span class=\"content\">${message.content}</span>","        </div>","      `","    }).join('');","","    const messages = document.querySelector('.messages');","","    messages.innerHTML = html;","    messages.scrollTop = messages.scrollHeight;"],"id":11}],[{"start":{"row":8,"column":4},"end":{"row":8,"column":5},"action":"remove","lines":["/"],"id":10}],[{"start":{"row":8,"column":5},"end":{"row":8,"column":6},"action":"remove","lines":["/"],"id":9}]]},"ace":{"folds":[],"scrolltop":0,"scrollleft":0,"selection":{"start":{"row":33,"column":4},"end":{"row":33,"column":4},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1516013240846,"hash":"6cef164a271486302c82043584c1e063bc0df305"}